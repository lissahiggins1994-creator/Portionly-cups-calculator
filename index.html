<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Portionly Cup Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #f6ecff;
      --card-bg: #ffffff;
      --accent: #f08fb4;
      --accent-soft: #ffd0e1;
      --text-main: #2b2136;
      --text-muted: #7b6a90;
      --border-subtle: #efe3ff;
      --radius-card: 22px;
      --shadow-soft: 0 18px 45px rgba(64, 33, 90, 0.16);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .page-wrap {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
    }

    .inner {
      max-width: 720px;
      width: 100%;
    }

    .logo {
      display: block;
      margin: 0 auto 12px;
      max-width: 140px;
    }

    .brand {
      text-align: center;
      font-size: 12px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: #a38ac7;
      margin-bottom: 6px;
    }

    .title {
      text-align: center;
      font-size: 26px;
      font-weight: 800;
      letter-spacing: 0.02em;
      margin-bottom: 4px;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 24px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-soft);
      padding: 22px 22px 20px;
      border: 1px solid var(--border-subtle);
    }

    .card-header-text {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    form {
      margin-top: 8px;
    }

    .field {
      margin-bottom: 12px;
    }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text-main);
    }

    input,
    select {
      font-family: inherit;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #e1d4ff;
      font-size: 14px;
      background: #faf7ff;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: #c39bff;
      box-shadow: 0 0 0 2px rgba(186, 145, 255, 0.25);
      background: #fff;
    }

    .grid-two {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }

    .unit-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    .unit-pill {
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid #e6d5ff;
      background: #faf7ff;
      font-size: 11px;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s, border 0.15s, color 0.15s;
    }

    .unit-pill.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .pace-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    .pace-pill {
      flex: 1;
      min-width: 90px;
      border-radius: 999px;
      border: 1px solid #e6d5ff;
      padding: 7px 10px;
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      background: #faf7ff;
      cursor: pointer;
      transition: background 0.15s, border 0.15s, transform 0.1s;
      user-select: none;
    }

    .pace-pill input {
      display: none;
    }

    .pace-pill span.emoji {
      font-size: 16px;
    }

    .pace-pill.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(240, 143, 180, 0.4);
    }

    .consent {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-top: 4px;
    }

    .consent input {
      margin-top: 3px;
    }

    .consent-text {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .btn-main {
      margin-top: 14px;
      width: 100%;
      border-radius: 999px;
      padding: 11px 16px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      background: linear-gradient(135deg, #ff9ac0, #f08fb4);
      color: white;
      cursor: pointer;
      box-shadow: 0 14px 32px rgba(244, 143, 177, 0.55);
      transition: transform 0.1s, box-shadow 0.1s, filter 0.15s;
    }

    .btn-main:hover {
      filter: brightness(1.03);
      box-shadow: 0 16px 36px rgba(244, 143, 177, 0.65);
      transform: translateY(-1px);
    }

    .btn-main:active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(244, 143, 177, 0.5);
    }

    .divider {
      margin: 16px 0 10px;
      border-top: 1px dashed #eadfff;
    }

    .disclaimer {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .results {
      margin-top: 18px;
      padding: 14px 12px 10px;
      border-radius: 16px;
      background: linear-gradient(135deg, #fff6ff, #f5f9ff);
      border: 1px solid #f1ddff;
    }

    .results-header {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .results-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .cups-list {
      list-style: none;
      padding-left: 0;
      margin: 0 0 10px;
      font-size: 13px;
    }

    .cups-list li {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
    }

    .cups-label {
      font-weight: 600;
    }

    .helper {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .error {
      margin-top: 8px;
      font-size: 12px;
      color: #c62828;
      font-weight: 600;
    }

    .healthy {
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-muted);
    }

    @media (max-width: 600px) {
      .card {
        padding: 18px 16px 16px;
      }
    }
  </style>
</head>

<body>
  <div class="page-wrap">
    <div class="inner">
      <!-- Your logo file MUST be in the same folder, named exactly 'portionly-logo.png' -->
      <img src="portionly-logo.png" alt="Portionly logo" class="logo" />

      <div class="brand">Portionly ‚Äî Wellbeing</div>
      <div class="title">Your Portionly Cup Calculator</div>
      <div class="subtitle">
        No maths. No guilt. Just a gentle starting point you can adjust as you go.
      </div>

      <div class="card">
        <div class="card-header-text">
          Fill this in to get a rough daily guide for your Portionly cups. These
          numbers are <strong>guidelines, not rules.</strong> Real life will wobble ‚Äî
          and that‚Äôs allowed here.
        </div>

        <form id="calc-form" novalidate>
          <div class="field">
            <label for="gender">Gender</label>
            <select id="gender" required>
              <option value="female">Female</option>
              <option value="male">Male</option>
            </select>
          </div>

          <div class="grid-two">
            <div class="field">
              <label for="age">Age (years)</label>
              <input id="age" type="number" min="10" max="100" required />
            </div>
            <div class="field">
              <label>Height</label>
              <input id="height-main" type="number" min="10" max="250" placeholder="Value" />
              <div class="unit-row">
                <span class="unit-pill active" data-height-unit="cm">cm</span>
                <span class="unit-pill" data-height-unit="ftin">ft + in</span>
                <span class="unit-pill" data-height-unit="in">inches only</span>
              </div>
              <div class="helper" id="height-helper">
                Using centimetres. Switch if you think in feet or inches.
              </div>
              <!-- extra fields for ft/in when needed -->
              <div id="height-ftin-row" style="display:none; margin-top:4px; gap:6px;" class="unit-row">
                <input id="height-ft" type="number" min="3" max="8" placeholder="ft" style="flex:1;" />
                <input id="height-in" type="number" min="0" max="11" placeholder="in" style="flex:1;" />
              </div>
            </div>
          </div>

          <div class="field">
            <label>Weight</label>
            <input id="weight-main" type="number" min="10" max="400" placeholder="Value" />
            <div class="unit-row">
              <span class="unit-pill active" data-weight-unit="kg">kg</span>
              <span class="unit-pill" data-weight-unit="stlb">st + lb</span>
              <span class="unit-pill" data-weight-unit="lb">lbs</span>
            </div>
            <div class="helper" id="weight-helper">
              Using kilograms. Switch if you think in stones or pounds.
            </div>
            <div id="weight-stlb-row" style="display:none; margin-top:4px; gap:6px;" class="unit-row">
              <input id="weight-st" type="number" min="4" max="40" placeholder="st" style="flex:1;" />
              <input id="weight-lb" type="number" min="0" max="13" placeholder="lb" style="flex:1;" />
            </div>
          </div>

          <div class="field">
            <label for="activity">Activity level</label>
            <select id="activity" required>
              <option value="1.2">Sedentary (mostly sitting)</option>
              <option value="1.375">Lightly active (1‚Äì3 days/week)</option>
              <option value="1.55">Moderately active (3‚Äì5 days/week)</option>
              <option value="1.725">Very active (6‚Äì7 days/week)</option>
              <option value="1.9">Extra active (physical job + training)</option>
            </select>
          </div>

          <div class="field">
            <label>How fast do you want to move?</label>
            <div class="helper">
              This just changes how gentle or punchy your plan is. Faster isn‚Äôt always better ‚Äî choose what feels sustainable.
            </div>
            <div class="pace-row" id="pace-row">
              <label class="pace-pill active" data-pace="gentle">
                <input type="radio" name="pace" value="gentle" checked />
                <span class="emoji">üåø</span>
                <span>Gentle</span>
              </label>
              <label class="pace-pill" data-pace="standard">
                <input type="radio" name="pace" value="standard" />
                <span class="emoji">‚öñÔ∏è</span>
                <span>Standard</span>
              </label>
              <label class="pace-pill" data-pace="faster">
                <input type="radio" name="pace" value="faster" />
                <span class="emoji">üî•</span>
                <span>Faster</span>
              </label>
            </div>
          </div>

          <div class="consent">
            <input type="checkbox" id="consent" />
            <div class="consent-text">
              I understand this is general guidance only and not medical advice.
              If I have health conditions, I‚Äôll talk to a doctor or dietitian
              before making big changes.
            </div>
          </div>

          <button type="submit" class="btn-main">Calculate my cups</button>
          <div id="error" class="error" style="display:none;"></div>

          <div class="divider"></div>

          <div class="disclaimer">
            A gentle starting point based on the info you shared. You can tweak this later ‚Äî nothing is locked in stone.
          </div>
        </form>

        <div id="results" class="results" style="display:none;">
          <div class="results-header" id="results-title"></div>
          <div class="results-sub">
            Friendly reminder: these cups are guidance, not rules. Real life will wobble ‚Äî and that‚Äôs allowed here.
          </div>
          <ul class="cups-list" id="cups-list"></ul>
          <div class="healthy" id="healthy-range"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- constants & helpers ---
    const KCAL_PER_KG = 7700;
    const KCAL_PER_CUP = {
      Protein: 120,
      Carbs: 130,
      Veggies: 25,
      Fruits: 65,
      "Healthy Fats": 100,
    };

    function getMinCalories(gender) {
      return gender === "female" ? 1200 : 1500;
    }

    function calculateBMR({ gender, weightKg, heightCm, age }) {
      return (
        10 * weightKg +
        6.25 * heightCm -
        5 * age +
        (gender === "female" ? -161 : 5)
      );
    }

    function calculateTDEE(profile) {
      return calculateBMR(profile) * profile.activityFactor;
    }

    function calculateCalorieTarget(profile, pace) {
      const tdee = calculateTDEE(profile);
      const minCals = getMinCalories(profile.gender);

      let weeklyTargetKg;
      if (pace === "gentle") weeklyTargetKg = 0.25;
      else if (pace === "faster") weeklyTargetKg = 0.75;
      else weeklyTargetKg = 0.5;

      const desiredDailyDeficit = (weeklyTargetKg * KCAL_PER_KG) / 7;
      const maxDeficitByPercent = 0.2 * tdee;
      const maxDeficitAbsolute = 1000;

      let dailyDeficit = Math.min(
        desiredDailyDeficit,
        maxDeficitByPercent,
        maxDeficitAbsolute
      );

      let targetCalories = tdee - dailyDeficit;

      if (targetCalories < minCals) {
        targetCalories = minCals;
        dailyDeficit = Math.max(0, tdee - targetCalories);
      }

      return Math.round(targetCalories);
    }

    function calculateCupPlan(targetCalories) {
      const split = { Protein: 0.3, Carbs: 0.4, "Healthy Fats": 0.3 };

      const veggieCups =
        targetCalories < 1600 ? 4 : targetCalories < 2200 ? 5 : 6;
      const fruitCups = targetCalories < 1600 ? 2 : 3;

      const proteinCalories = targetCalories * split.Protein;
      const carbCalories = targetCalories * split.Carbs;
      const fatCalories = targetCalories * split["Healthy Fats"];

      let proteinCups = Math.round(
        proteinCalories / KCAL_PER_CUP.Protein
      );
      let carbCups = Math.round(carbCalories / KCAL_PER_CUP.Carbs);
      let fatCups = Math.round(
        fatCalories / KCAL_PER_CUP["Healthy Fats"]
      );

      if (proteinCups < 3) proteinCups = 3;
      if (carbCups < 3) carbCups = 3;
      if (fatCups < 2) fatCups = 2;

      return {
        Protein: proteinCups,
        Carbs: carbCups,
        Veggies: veggieCups,
        Fruits: fruitCups,
        "Healthy Fats": fatCups,
      };
    }

    function calculateDietPlan(profile, pace) {
      const targetCalories = calculateCalorieTarget(profile, pace);
      const cups = calculateCupPlan(targetCalories);
      return { cups, targetCalories };
    }

    // --- unit state ---
    let heightUnit = "cm";   // 'cm' | 'ftin' | 'in'
    let weightUnit = "kg";   // 'kg' | 'stlb' | 'lb'
    let lastProfileInputs = null; // for recalcing when pace changes

    // height unit toggles
    document.querySelectorAll("[data-height-unit]").forEach(pill => {
      pill.addEventListener("click", () => {
        heightUnit = pill.dataset.heightUnit;
        document.querySelectorAll("[data-height-unit]").forEach(el =>
          el.classList.toggle("active", el === pill)
        );

        const helper = document.getElementById("height-helper");
        const row = document.getElementById("height-ftin-row");
        if (heightUnit === "cm") {
          helper.textContent =
            "Using centimetres. Switch if you think in feet or inches.";
          row.style.display = "none";
        } else if (heightUnit === "in") {
          helper.textContent =
            "Using total inches (for example 66 for 5ft 6in).";
          row.style.display = "none";
        } else {
          helper.textContent =
            "Using feet and inches. Leave the top box blank.";
          row.style.display = "flex";
        }
      });
    });

    // weight unit toggles
    document.querySelectorAll("[data-weight-unit]").forEach(pill => {
      pill.addEventListener("click", () => {
        weightUnit = pill.dataset.weightUnit;
        document.querySelectorAll("[data-weight-unit]").forEach(el =>
          el.classList.toggle("active", el === pill)
        );

        const helper = document.getElementById("weight-helper");
        const row = document.getElementById("weight-stlb-row");
        if (weightUnit === "kg") {
          helper.textContent =
            "Using kilograms. Switch if you think in stones or pounds.";
          row.style.display = "none";
        } else if (weightUnit === "lb") {
          helper.textContent =
            "Using pounds. Put the full number (for example 180).";
          row.style.display = "none";
        } else {
          helper.textContent =
            "Using stones and pounds. Leave the top box blank.";
          row.style.display = "flex";
        }
      });
    });

    // pace pills
    let selectedPace = "gentle";
    const paceRow = document.getElementById("pace-row");
    paceRow.addEventListener("click", e => {
      const pill = e.target.closest(".pace-pill");
      if (!pill) return;
      selectedPace = pill.dataset.pace;

      document.querySelectorAll(".pace-pill").forEach(el => {
        el.classList.toggle("active", el === pill);
        const input = el.querySelector("input[type=radio]");
        if (input) input.checked = el === pill;
      });

      // if we've already calculated once, recalc immediately for new pace
      if (lastProfileInputs) {
        const plan = calculateDietPlan(lastProfileInputs, selectedPace);
        renderResults(plan, lastProfileInputs);
      }
    });

    // form submit
    document.getElementById("calc-form").addEventListener("submit", e => {
      e.preventDefault();
      const errorEl = document.getElementById("error");
      errorEl.style.display = "none";

      try {
        const gender = document.getElementById("gender").value;
        const age = parseInt(document.getElementById("age").value, 10);
        const activityFactor = parseFloat(
          document.getElementById("activity").value
        );
        const consent = document.getElementById("consent").checked;

        if (!consent) {
          throw new Error(
            "Please confirm you understand this is general guidance only before continuing."
          );
        }

        if (!gender || !age || !activityFactor) {
          throw new Error("Please fill in gender, age and activity level.");
        }

        // height
        let heightCm;
        if (heightUnit === "cm") {
          const val = parseFloat(
            document.getElementById("height-main").value
          );
          if (!val) throw new Error("Please enter your height in cm.");
          heightCm = val;
        } else if (heightUnit === "in") {
          const val = parseFloat(
            document.getElementById("height-main").value
          );
          if (!val) throw new Error("Please enter your height in inches.");
          heightCm = val * 2.54;
        } else {
          const ft = parseFloat(
            document.getElementById("height-ft").value
          );
          const inch = parseFloat(
            document.getElementById("height-in").value
          );
          if (isNaN(ft) || isNaN(inch)) {
            throw new Error("Please enter height in feet and inches.");
          }
          heightCm = (ft * 12 + inch) * 2.54;
        }

        // weight
        let weightKg;
        if (weightUnit === "kg") {
          const val = parseFloat(
            document.getElementById("weight-main").value
          );
          if (!val) throw new Error("Please enter your weight in kg.");
          weightKg = val;
        } else if (weightUnit === "lb") {
          const val = parseFloat(
            document.getElementById("weight-main").value
          );
          if (!val) throw new Error("Please enter your weight in lbs.");
          weightKg = val * 0.453592;
        } else {
          const st = parseFloat(
            document.getElementById("weight-st").value
          );
          const lb = parseFloat(
            document.getElementById("weight-lb").value
          );
          if (isNaN(st) || isNaN(lb)) {
            throw new Error("Please enter weight in stones and pounds.");
          }
          weightKg = (st * 14 + lb) * 0.453592;
        }

        const profile = {
          gender,
          age,
          heightCm,
          weightKg,
          activityFactor,
        };
        lastProfileInputs = profile;

        const plan = calculateDietPlan(profile, selectedPace);
        renderResults(plan, profile);
      } catch (err) {
        errorEl.textContent = err.message || "Something went wrong.";
        errorEl.style.display = "block";
        document.getElementById("results").style.display = "none";
      }
    });

    function renderResults(plan, profile) {
      const results = document.getElementById("results");
      const list = document.getElementById("cups-list");
      const title = document.getElementById("results-title");
      const healthy = document.getElementById("healthy-range");

      const paceLabel =
        selectedPace === "gentle"
          ? "Gentle"
          : selectedPace === "faster"
          ? "Faster"
          : "Standard";

      title.textContent = `${paceLabel} pace cups plan`;

      list.innerHTML = "";
      Object.entries(plan.cups).forEach(([name, cups]) => {
        const li = document.createElement("li");
        const left = document.createElement("span");
        left.textContent = name;
        left.className = "cups-label";
        const right = document.createElement("span");
        right.textContent = `${cups} cups`;
        li.appendChild(left);
        li.appendChild(right);
        list.appendChild(li);
      });

      // healthy weight range (kg only, just as a soft guide)
      const hMeters = profile.heightCm / 100;
      const minW = Math.round(22 * hMeters * hMeters);
      const maxW = Math.round(27 * hMeters * hMeters);
      healthy.textContent =
        "Based on your height, a gentle healthy weight range might be around " +
        `${minW}‚Äì${maxW} kg. This is just one lens, not a verdict ‚Äî your doctor or dietitian may give you a more personalised range.`;

      results.style.display = "block";
    }
  </script>
</body>
</html>
