<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Portionly Cup Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #f6ecff;
      --card-bg: #ffffff;
      --accent: #f08fb4;
      --text-main: #2b2136;
      --text-muted: #7b6a90;
      --border-subtle: #efe3ff;
      --radius-card: 22px;
      --shadow-soft: 0 18px 45px rgba(64, 33, 90, 0.16);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .page-wrap {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
    }

    .inner { max-width: 720px; width: 100%; }

    .logo {
      display: block;
      margin: 0 auto 12px;
      max-width: 140px;
    }

    .brand {
      text-align: center;
      font-size: 12px;
      letter-spacing: 0.18em;
      text-transform: lowercase;
      color: #a38ac7;
      margin-bottom: 6px;
    }

    .title {
      text-align: center;
      font-size: 26px;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 24px;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-soft);
      padding: 24px 22px 20px;
      border: 1px solid var(--border-subtle);
    }

    .card-header-text {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .field-group {
      margin-top: 18px;
    }

    .field { margin-bottom: 12px; }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #e1d4ff;
      background: #faf7ff;
      font-size: 14px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: #c39bff;
      box-shadow: 0 0 0 2px rgba(186,145,255,0.25);
      background: #fff;
    }

    .grid-two {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .unit-row {
      display: inline-flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .unit-pill {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #f3e7ff;
      background: #fbf7ff;
      font-size: 10px;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s, border 0.15s, color 0.15s;
    }

    .unit-pill.active {
      background: #ffc0d6;
      border-color: var(--accent);
      color: #fff;
    }

    .helper {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
      opacity: 0.85;
    }

    .pace-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .pace-pill {
      flex: 1;
      min-width: 90px;
      border-radius: 999px;
      border: 1px solid #e6d5ff;
      padding: 7px 10px;
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      background: #faf7ff;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s, border 0.15s, transform 0.1s;
    }

    .pace-pill span.emoji { font-size: 16px; }

    .pace-pill.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(240,143,180,0.4);
    }

    .consent {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-top: 10px;
    }

    .consent input { margin-top: 3px; }

    .consent-text {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .btn-main {
      margin-top: 16px;
      width: 100%;
      border-radius: 999px;
      padding: 11px 16px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      background: linear-gradient(135deg,#ff9ac0,#f08fb4);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 14px 32px rgba(244,143,177,0.55);
      transition: transform 0.1s, box-shadow 0.1s, filter 0.15s;
    }

    .btn-main:hover {
      filter: brightness(1.03);
      box-shadow: 0 16px 36px rgba(244,143,177,0.65);
      transform: translateY(-1px);
    }

    .btn-main:active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(244,143,177,0.5);
    }

    .divider {
      margin: 18px 0 10px;
      border-top: 1px dashed #eadfff;
    }

    .disclaimer {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .results {
      margin-top: 18px;
      padding: 14px 12px 10px;
      border-radius: 16px;
      background: linear-gradient(135deg,#fff6ff,#f5f9ff);
      border: 1px solid #f1ddff;
    }

    .results-header {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .results-summary {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .results-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .cups-list {
      list-style: none;
      padding-left: 0;
      margin: 0 0 8px;
      font-size: 13px;
    }

    .cups-list li {
      display: flex;
      justify-content: space-between;
      padding: 3px 0;
    }

    .cups-label { font-weight: 600; }

    .healthy {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .about-note {
      font-size: 10px;
      color: #a395c0;
      margin-top: 6px;
    }

    .error {
      margin-top: 8px;
      font-size: 12px;
      color: #c0392b;
      background: #fdecea;
      border-radius: 8px;
      padding: 6px 8px;
      font-weight: 500;
    }

    @media (max-width: 600px) {
      .card {
        padding: 18px 16px 16px;
      }
    }
  </style>
</head>

<body>
  <div class="page-wrap">
    <div class="inner">
      <img src="portionly-logo.png" alt="Portionly logo" class="logo" />

      <div class="brand">portionly wellbeing</div>
      <div class="title">Portionly Cup Calculator</div>
      <div class="subtitle">
        No maths. No guilt. Just a gentle starting point you can adjust as you go.
      </div>

      <div class="card">
        <div class="card-header-text">
          Fill this in to get a rough daily guide for your Portionly cups. These
          numbers are <strong>guidelines, not rules.</strong> Real life will wobble ‚Äî
          and that‚Äôs allowed here.
        </div>

        <form id="calc-form" novalidate>
          <div class="field-group">
            <div class="field">
              <label for="gender">Gender</label>
              <select id="gender">
                <option value="female">Female</option>
                <option value="male">Male</option>
              </select>
            </div>

            <div class="field">
              <label for="age">Age (years)</label>
              <input id="age" type="number" min="10" max="100" />
            </div>

            <div class="field">
              <label>Height</label>
              <div class="unit-row">
                <span class="unit-pill active" data-height-unit="cm">cm</span>
                <span class="unit-pill" data-height-unit="ftin">ft + in</span>
              </div>

              <!-- cm only -->
              <div id="heightCmRow" style="margin-top:6px;">
                <input id="heightCm" type="number" min="80" max="250" placeholder="cm" />
              </div>

              <!-- ft + in -->
              <div id="heightFtInRow" style="margin-top:6px; display:none;">
                <div class="grid-two">
                  <input id="heightFt" type="number" min="3" max="8" placeholder="ft" />
                  <input id="heightIn" type="number" min="0" max="11" placeholder="in" />
                </div>
              </div>

              <div class="helper" id="height-helper">
                Use centimetres or feet and inches ‚Äî whichever feels easier.
              </div>
            </div>

            <div class="field">
              <label>Weight</label>
              <div class="unit-row">
                <span class="unit-pill active" data-weight-unit="kg">kg</span>
                <span class="unit-pill" data-weight-unit="lb">lbs</span>
                <span class="unit-pill" data-weight-unit="stone">stone &amp; lb</span>
              </div>

              <!-- kg -->
              <div id="weightKgRow" style="margin-top:6px;">
                <input id="weightKg" type="number" min="30" max="300" step="0.1" placeholder="kg" />
              </div>

              <!-- lbs -->
              <div id="weightLbRow" style="margin-top:6px; display:none;">
                <input id="weightLb" type="number" min="70" max="660" step="0.5" placeholder="lbs" />
              </div>

              <!-- stone + lb -->
              <div id="weightStRow" style="margin-top:6px; display:none;">
                <div class="grid-two">
                  <input id="weightSt" type="number" min="5" max="45" step="1" placeholder="st" />
                  <input id="weightStLb" type="number" min="0" max="13" step="0.5" placeholder="lb" />
                </div>
              </div>

              <div class="helper" id="weight-helper">
                Use the row that matches how you usually think about weight.
              </div>
            </div>
          </div>

          <div class="field-group">
            <div class="field">
              <label for="activity">Activity level</label>
              <select id="activity">
                <option value="1.2">Sedentary (mostly sitting)</option>
                <option value="1.375">Lightly active (1‚Äì3 days/week)</option>
                <option value="1.55">Moderately active (3‚Äì5 days/week)</option>
                <option value="1.725">Very active (6‚Äì7 days/week)</option>
                <option value="1.9">Extra active (physical job + training)</option>
              </select>
            </div>

            <div class="field">
              <label>How fast do you want to move?</label>
              <div class="helper">
                This just changes how gentle or punchy your plan is. Faster isn‚Äôt always better ‚Äî choose what feels sustainable.
              </div>
              <div class="pace-row" id="pace-row">
                <label class="pace-pill active" data-pace="gentle">
                  <span class="emoji">üåø</span><span>Gentle</span>
                </label>
                <label class="pace-pill" data-pace="standard">
                  <span class="emoji">‚öñÔ∏è</span><span>Standard</span>
                </label>
                <label class="pace-pill" data-pace="faster">
                  <span class="emoji">üî•</span><span>Faster</span>
                </label>
              </div>
            </div>
          </div>

          <div class="field-group">
            <div class="consent">
              <input type="checkbox" id="consent" />
              <div class="consent-text">
                I understand this is general guidance only and not medical advice.
                If I have health conditions, I‚Äôll talk to a doctor or dietitian
                before making big changes.
              </div>
            </div>

            <button type="submit" class="btn-main">Calculate my cups</button>
            <div id="error" class="error" style="display:none;"></div>

            <div class="divider"></div>

            <div class="disclaimer">
              A gentle starting point based on the info you shared. You can tweak
              this later ‚Äî nothing is locked in stone.
            </div>
          </div>
        </form>

        <div id="results" class="results" style="display:none;">
          <div class="results-header" id="results-title"></div>
          <div class="results-summary" id="results-summary"></div>
          <div class="results-sub">
            Friendly reminder: these cups are guidance, not rules. Real life will
            wobble ‚Äî and that‚Äôs allowed here.
          </div>
          <ul class="cups-list" id="cups-list"></ul>
          <div class="healthy" id="healthy-range"></div>
          <div class="about-note">
            This calculator uses typical energy needs and spreads them across protein,
            carbs, healthy fats, fruits and veggies. It‚Äôs here to give you ideas,
            not a rulebook.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- core maths (calories hidden from user) ----------
    const KCAL_PER_CUP = {
      Protein: 120,
      Carbs: 130,
      Veggies: 25,
      Fruits: 65,
      "Healthy Fats": 100,
    };

    function minCalories(gender) {
      return gender === "female" ? 1200 : 1500;
    }

    function calcBMR(p) {
      return (
        10 * p.weightKg +
        6.25 * p.heightCm -
        5 * p.age +
        (p.gender === "female" ? -161 : 5)
      );
    }

    function calcTDEE(p) {
      return calcBMR(p) * p.activityFactor;
    }

    function calcTargetCalories(p, pace) {
      const tdee = calcTDEE(p);
      const minCals = minCalories(p.gender);

      let frac;
      if (pace === "gentle") frac = 0.10;
      else if (pace === "faster") frac = 0.20;
      else frac = 0.15;

      let deficit = tdee * frac;
      if (deficit > 1000) deficit = 1000;

      let target = tdee - deficit;
      if (target < minCals) target = minCals;

      return Math.round(target);
    }

    // protein kept highest; fats reduced on faster pace
    function calcCups(targetCalories, pace) {
      let proteinPct = 0.34;
      let carbPct   = 0.38;
      let fatPct    = 0.28;

      if (pace === "gentle") {
        proteinPct = 0.32;
        carbPct    = 0.36;
        fatPct     = 0.32;
      } else if (pace === "faster") {
        proteinPct = 0.37;
        carbPct    = 0.37;
        fatPct     = 0.26; // fats down on faster
      }

      const vegCups   = targetCalories < 1600 ? 4 : targetCalories < 2200 ? 5 : 6;
      const fruitCups = targetCalories < 1600 ? 2 : 3;

      const proteinCalories = targetCalories * proteinPct;
      const carbCalories    = targetCalories * carbPct;
      const fatCalories     = targetCalories * fatPct;

      let proteinCups = Math.round(proteinCalories / KCAL_PER_CUP.Protein);
      let carbCups    = Math.round(carbCalories    / KCAL_PER_CUP.Carbs);
      let fatCups     = Math.round(fatCalories     / KCAL_PER_CUP["Healthy Fats"]);

      if (proteinCups < 3) proteinCups = 3;
      if (carbCups   < 3) carbCups = 3;
      if (fatCups    < 2) fatCups  = 2;

      // keep protein clearly leading
      if (proteinCups <= carbCups) proteinCups = carbCups + 1;

      return {
        Protein: proteinCups,
        Carbs: carbCups,
        Veggies: vegCups,
        Fruits: fruitCups,
        "Healthy Fats": fatCups,
      };
    }

    function calcPlan(profile, pace) {
      const target = calcTargetCalories(profile, pace);
      const cups = calcCups(target, pace);
      return { cups, targetCalories: target };
    }

    // ---------- UI state ----------
    let heightUnit = "cm";   // 'cm' | 'ftin'
    let weightUnit = "kg";   // 'kg' | 'lb' | 'stone'
    let selectedPace = "gentle";
    let lastProfileInputs = null;

    // Height unit toggles
    document.querySelectorAll("[data-height-unit]").forEach(pill => {
      pill.addEventListener("click", () => {
        heightUnit = pill.dataset.heightUnit;
        document.querySelectorAll("[data-height-unit]").forEach(el =>
          el.classList.toggle("active", el === pill)
        );
        document.getElementById("heightCmRow").style.display =
          heightUnit === "cm" ? "block" : "none";
        document.getElementById("heightFtInRow").style.display =
          heightUnit === "ftin" ? "block" : "none";
      });
    });

    // Weight unit toggles
    document.querySelectorAll("[data-weight-unit]").forEach(pill => {
      pill.addEventListener("click", () => {
        weightUnit = pill.dataset.weightUnit;
        document.querySelectorAll("[data-weight-unit]").forEach(el =>
          el.classList.toggle("active", el === pill)
        );
        document.getElementById("weightKgRow").style.display =
          weightUnit === "kg" ? "block" : "none";
        document.getElementById("weightLbRow").style.display =
          weightUnit === "lb" ? "block" : "none";
        document.getElementById("weightStRow").style.display =
          weightUnit === "stone" ? "block" : "none";
      });
    });

    // Pace selection
    document.getElementById("pace-row").addEventListener("click", e => {
      const pill = e.target.closest(".pace-pill");
      if (!pill) return;
      selectedPace = pill.dataset.pace;
      document.querySelectorAll(".pace-pill").forEach(el =>
        el.classList.toggle("active", el === pill)
      );
      if (lastProfileInputs) {
        const plan = calcPlan(lastProfileInputs, selectedPace);
        renderResults(plan, lastProfileInputs);
      }
    });

    // Form submit
    document.getElementById("calc-form").addEventListener("submit", e => {
      e.preventDefault();
      const errorEl = document.getElementById("error");
      errorEl.style.display = "none";

      try {
        const gender = document.getElementById("gender").value;
        const ageVal = parseFloat(document.getElementById("age").value);
        const activityFactor = parseFloat(
          document.getElementById("activity").value
        );
        const consent = document.getElementById("consent").checked;

        if (!consent) {
          throw new Error(
            "Looks like you haven't ticked the guidance box yet. Please confirm you understand this is general guidance only."
          );
        }

        if (!gender || !ageVal || !activityFactor) {
          throw new Error("Please add your gender, age and activity level so we can sketch a plan.");
        }

        // Height
        let heightCm;
        if (heightUnit === "cm") {
          const cmVal = parseFloat(document.getElementById("heightCm").value);
          if (!cmVal) throw new Error("Please enter your height in cm.");
          heightCm = cmVal;
        } else {
          const ftVal = parseFloat(document.getElementById("heightFt").value);
          const inVal = parseFloat(document.getElementById("heightIn").value);
          if (isNaN(ftVal) || isNaN(inVal)) {
            throw new Error("Please enter your height in feet and inches.");
          }
          const totalInches = ftVal * 12 + inVal;
          heightCm = totalInches * 2.54;
        }

        // Weight
        let weightKg;
        if (weightUnit === "kg") {
          const kgVal = parseFloat(document.getElementById("weightKg").value);
          if (!kgVal) throw new Error("Please enter your weight in kg.");
          weightKg = kgVal;
        } else if (weightUnit === "lb") {
          const lbVal = parseFloat(document.getElementById("weightLb").value);
          if (!lbVal) throw new Error("Please enter your weight in lbs.");
          weightKg = lbVal * 0.453592;
        } else {
          const stVal = parseFloat(document.getElementById("weightSt").value);
          const stLbVal = parseFloat(
            document.getElementById("weightStLb").value
          );
          if (isNaN(stVal) || isNaN(stLbVal)) {
            throw new Error("Please enter your weight in stone and pounds.");
          }
          const totalLb = stVal * 14 + stLbVal;
          weightKg = totalLb * 0.453592;
        }

        const profile = {
          gender,
          age: ageVal,
          heightCm,
          weightKg,
          activityFactor,
        };
        lastProfileInputs = profile;

        const plan = calcPlan(profile, selectedPace);
        renderResults(plan, profile);
      } catch (err) {
        errorEl.textContent = err.message || "Something went wrong while calculating your cups.";
        errorEl.style.display = "block";
        document.getElementById("results").style.display = "none";
      }
    });

    function renderResults(plan, profile) {
      const results = document.getElementById("results");
      const list = document.getElementById("cups-list");
      const title = document.getElementById("results-title");
      const summary = document.getElementById("results-summary");
      const healthy = document.getElementById("healthy-range");

      const paceLabel =
        selectedPace === "gentle"
          ? "Gentle"
          : selectedPace === "faster"
          ? "Faster"
          : "Standard";

      title.textContent = `${paceLabel} pace cups plan`;

      if (selectedPace === "gentle") {
        summary.textContent =
          "Gentle pace: small, steady shifts with a bit more flexibility in fats.";
      } else if (selectedPace === "standard") {
        summary.textContent =
          "Standard pace: balanced changes with protein leading the way.";
      } else {
        summary.textContent =
          "Faster pace: higher protein and slightly lower fats to support a stronger push.";
      }

      list.innerHTML = "";
      Object.entries(plan.cups).forEach(([name, cups]) => {
        const li = document.createElement("li");
        const left = document.createElement("span");
        left.textContent = name;
        left.className = "cups-label";
        const right = document.createElement("span");
        right.textContent = `${cups} cups`;
        li.appendChild(left);
        li.appendChild(right);
        list.appendChild(li);
      });

      const hMeters = profile.heightCm / 100;
      const minW = Math.round(22 * hMeters * hMeters);
      const maxW = Math.round(27 * hMeters * hMeters);
      healthy.textContent =
        "If you like having a ballpark number, this gives a height-based range of around " +
        `${minW}‚Äì${maxW} kg. Your own healthiest weight might sit above or below this ‚Äî a doctor or dietitian can help you personalise it.`;

      results.style.display = "block";
    }
  </script>
</body>
</html>
