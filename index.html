<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Portionly Cup Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #f7f1ff;
      --card-bg: #ffffff;
      --accent: #f38fb8;
      --accent-strong: #d881ff;
      --text-main: #2b2136;
      --text-muted: #7b6a90;
      --border-subtle: #efe3ff;
      --radius-card: 22px;
      --shadow-soft: 0 18px 45px rgba(64, 33, 90, 0.16);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #ffe2ff 0, var(--bg) 38%, #f3f7ff 100%);
      color: var(--text-main);
    }

    .page-wrap {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
    }

    .inner { max-width: 720px; width: 100%; }

    .logo {
      display: block;
      margin: 0 auto 12px;
      max-width: 140px;
    }

    .brand {
      text-align: center;
      font-size: 12px;
      letter-spacing: 0.18em;
      text-transform: lowercase;
      color: #a38ac7;
      margin-bottom: 6px;
    }

    .title {
      text-align: center;
      font-size: 26px;
      font-weight: 800;
      margin-bottom: 4px;
      letter-spacing: 0.02em;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 24px;
      max-width: 520px;
      margin-left: auto;
      margin-right: auto;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-card);
      box-shadow: var(--shadow-soft);
      padding: 24px 22px 20px;
      border: 1px solid var(--border-subtle);
    }

    .card-header-text {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .field-group { margin-top: 18px; }
    .field { margin-bottom: 12px; }

    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #e1d4ff;
      background: #faf7ff;
      font-size: 14px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input::placeholder {
      color: #b7a9d0;
      font-size: 12px;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: #c39bff;
      box-shadow: 0 0 0 2px rgba(186,145,255,0.25);
      background: #fff;
    }

    .grid-two {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
    }

    .unit-row {
      display: inline-flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .unit-pill {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #f3e7ff;
      background: #fbf7ff;
      font-size: 10px;
      cursor: pointer;
      user-select: none;
      transition: background 0.15s, border 0.15s, color 0.15s, transform 0.08s;
    }

    .unit-pill:hover {
      transform: translateY(-1px);
      border-color: #e3ccff;
    }

    .unit-pill.active {
      background: #ffc0d6;
      border-color: var(--accent);
      color: #fff;
    }

    .helper {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
      opacity: 0.85;
    }

    .consent {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-top: 10px;
    }

    .consent input { margin-top: 3px; }

    .consent-text {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .btn-main {
      margin-top: 16px;
      width: 100%;
      border-radius: 999px;
      padding: 11px 16px;
      border: none;
      font-size: 15px;
      font-weight: 700;
      background: linear-gradient(135deg,#ff9fc4,#d881ff);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 14px 32px rgba(217,129,255,0.55);
      transition: transform 0.1s, box-shadow 0.1s, filter 0.15s;
    }

    .btn-main:hover {
      filter: brightness(1.04);
      box-shadow: 0 16px 36px rgba(217,129,255,0.65);
      transform: translateY(-1px);
    }

    .btn-main:active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(217,129,255,0.5);
    }

    .divider {
      margin: 18px 0 10px;
      border-top: 1px dashed #eadfff;
    }

    .disclaimer {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .results {
      margin-top: 18px;
      padding: 14px 12px 10px;
      border-radius: 16px;
      background: linear-gradient(135deg,#fff6ff,#f5f9ff);
      border: 1px solid #f1ddff;
      display: none;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 0.22s ease-out, transform 0.22s ease-out;
    }

    .results.results--visible {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .results-header {
      font-size: 14px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .results-summary {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .results-sub {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .cups-list {
      list-style: none;
      padding-left: 0;
      margin: 0 0 8px;
      font-size: 13px;
    }

    .cups-list li {
      display: flex;
      justify-content: space-between;
      padding: 3px 0;
      animation: cupPop 0.24s ease-out;
    }

    @keyframes cupPop {
      0%   { transform: scale(0.96); opacity: 0; }
      100% { transform: scale(1);    opacity: 1; }
    }

    .cups-label { font-weight: 600; }

    .healthy {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-muted);
    }

    .about-note {
      font-size: 10px;
      color: #a395c0;
      margin-top: 6px;
    }

    .cup-sizes-note {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
      line-height: 1.4;
    }

    .error {
      margin-top: 8px;
      font-size: 12px;
      color: #c0392b;
      background: #fdecea;
      border-radius: 8px;
      padding: 6px 8px;
      font-weight: 500;
    }

    @media (max-width: 600px) {
      .card { padding: 18px 16px 16px; }
    }
  </style>
</head>

<body>
  <div class="page-wrap">
    <div class="inner">
      <img src="portionly-logo.png" alt="Portionly logo" class="logo" />

      <div class="brand">portionly wellbeing</div>
      <div class="title">Portionly Cup Calculator</div>
      <div class="subtitle">
        Eating well should feel simple — not stressful. This gives you a steady daily guide so you can practise healthy habits.
        Any weight changes are a bonus, not the main goal.
      </div>

      <div class="card">
        <div class="card-header-text">
          Fill this in to get a rough daily guide for your Portionly cups. These
          numbers are <strong>guidelines, not rules.</strong> Real life will wobble —
          and that’s allowed here.
        </div>

        <form id="calc-form" novalidate>
          <!-- PERSONAL INFO -->
          <div class="field-group">
            <div class="field">
              <label for="gender">Gender</label>
              <select id="gender" required>
                <option value="female">Female</option>
                <option value="male">Male</option>
              </select>
            </div>

            <div class="field">
              <label for="age">Age (years)</label>
              <input id="age" type="number" min="10" max="100" placeholder="e.g. 34" required />
            </div>

            <div class="field">
              <label>Height</label>
              <div class="unit-row">
                <span class="unit-pill active" data-height-unit="cm">cm</span>
                <span class="unit-pill" data-height-unit="ftin">ft + in</span>
              </div>

              <div id="heightCmRow" style="margin-top:6px;">
                <input id="heightCm" type="number" min="80" max="250" placeholder="e.g. 165" />
              </div>

              <div id="heightFtInRow" style="margin-top:6px; display:none;">
                <div class="grid-two">
                  <input id="heightFt" type="number" min="3" max="8" placeholder="ft (e.g. 5)" />
                  <input id="heightIn" type="number" min="0" max="11" placeholder="in (e.g. 6)" />
                </div>
              </div>

              <div class="helper">
                Use centimetres or feet and inches — whichever feels easier.
              </div>
            </div>

            <div class="field">
              <label>Weight</label>
              <div class="unit-row">
                <span class="unit-pill active" data-weight-unit="kg">kg</span>
                <span class="unit-pill" data-weight-unit="lb">lbs</span>
                <span class="unit-pill" data-weight-unit="stone">stone &amp; lb</span>
              </div>

              <div id="weightKgRow" style="margin-top:6px;">
                <input id="weightKg" type="number" min="30" max="300" step="0.1" placeholder="e.g. 72" />
              </div>

              <div id="weightLbRow" style="margin-top:6px; display:none;">
                <input id="weightLb" type="number" min="70" max="660" step="0.5" placeholder="e.g. 160" />
              </div>

              <div id="weightStRow" style="margin-top:6px; display:none;">
                <div class="grid-two">
                  <input id="weightSt" type="number" min="5" max="45" step="1" placeholder="st (e.g. 11)" />
                  <input id="weightStLb" type="number" min="0" max="13" step="0.5" placeholder="lb (e.g. 7)" />
                </div>
              </div>

              <div class="helper">
                Use the row that matches how you usually think about weight.
              </div>
            </div>
          </div>

          <div class="field-group">
            <div class="field">
              <label for="activity">Activity level</label>
              <select id="activity" required>
                <option value="1.2">Sedentary (mostly sitting)</option>
                <option value="1.375">Lightly active (1–3 days/week)</option>
                <option value="1.55">Moderately active (3–5 days/week)</option>
                <option value="1.725">Very active (6–7 days/week)</option>
                <option value="1.9">Extra active (physical job + training)</option>
              </select>
            </div>
          </div>

          <div class="field-group">
            <div class="consent">
              <input type="checkbox" id="consent" />
              <div class="consent-text">
                I understand this is general guidance only and not medical advice.
                If I have health conditions, I’ll talk to a doctor or dietitian
                before making big changes.
              </div>
            </div>

            <button type="submit" class="btn-main">Show my cup plan</button>
            <div id="error" class="error" style="display:none;"></div>

            <div class="divider"></div>

            <div class="disclaimer">
              A gentle starting point based on the info you shared. You can tweak
              this later — nothing is locked in stone.
            </div>
          </div>
        </form>

        <div id="results" class="results">
          <div class="results-header">Your daily cup guide</div>
          <div class="results-summary" id="results-summary">
            These cups are designed to feel satisfying and balanced. Use them as a guide you can lean on, not a target you have to hit perfectly.
          </div>
          <div class="results-sub">
            Friendly reminder: these cups are guidance, not rules. Real life will wobble — and that’s allowed here.
          </div>

          <ul class="cups-list" id="cups-list"></ul>

          <div class="cup-sizes-note">
            Each Portionly cup links to a colour and kitchen measure:<br>
            <strong>Pink</strong> Protein — ¾ cup •
            <strong>Yellow</strong> Carbs — ½ cup •
            <strong>Green</strong> Veggies — 1 cup •
            <strong>Purple</strong> Fruit — 1 cup •
            <strong>Orange</strong> Healthy Fats — ⅓ cup •
            <strong>Blue</strong> Seeds &amp; Dressings — 2 tbsp.
          </div>

          <div class="healthy" id="healthy-range"></div>
          <div class="about-note">
            This tool uses well-known nutrition guidelines to spread your daily
            energy across protein, carbs, healthy fats, fruits and veggies.
            It’s here to support habits, not control you.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- core maths (calories hidden, cups shown) ----------

    const KCAL_PER_CUP = {
      Protein: 110,           // ¾ cup lean-ish protein
      Carbs: 80,              // ½ cup cooked carbs
      Veggies: 15,            // 1 cup non-starchy veg
      Fruits: 55,             // 1 cup fruit
      "Healthy Fats": 150,    // ⅓ cup fats
      "Seeds & Dressings": 60 // 2 tbsp seeds/dressings
    };

    function minCalories(gender) {
      return gender === "female" ? 1300 : 1600;
    }

    function calcBMR(p) {
      return (
        10 * p.weightKg +
        6.25 * p.heightCm -
        5 * p.age +
        (p.gender === "female" ? -161 : 5)
      );
    }

    function calcTDEE(p) {
      return calcBMR(p) * p.activityFactor;
    }

    function calcTargetCalories(p) {
      const tdee = calcTDEE(p);
      const heightM = p.heightCm / 100;
      const bmi = p.weightKg / (heightM * heightM);

      let reductionPct;
      if (bmi < 23) {
        reductionPct = 0.0;
      } else if (bmi < 27) {
        reductionPct = 0.08;
      } else if (bmi < 32) {
        reductionPct = 0.12;
      } else {
        reductionPct = 0.15;
      }

      let target = tdee * (1 - reductionPct);
      const minCals = minCalories(p.gender);
      if (target < minCals) target = minCals;
      return Math.round(target);
    }
// higher-protein, slightly lower carbs, with sensible caps
function calcCups(targetCalories) {
  // macro split used just for rough structure
  const proteinPct = 0.42;
  const carbPct    = 0.28;
  const fatPct     = 0.30;

  const proteinCalories = targetCalories * proteinPct;
  const carbCalories    = targetCalories * carbPct;
  const fatCalories     = targetCalories * fatPct;

  let proteinCups = Math.round(proteinCalories / KCAL_PER_CUP.Protein);
  let carbCups    = Math.round(carbCalories    / KCAL_PER_CUP.Carbs);
  let fatCups     = Math.round(fatCalories     / KCAL_PER_CUP["Healthy Fats"]);

  // minimums so nothing drops too low
  if (proteinCups < 3) proteinCups = 3;
  if (carbCups   < 2) carbCups   = 2;
  if (fatCups    < 1) fatCups    = 1;

  // caps so things don’t get silly
  if (proteinCups > 8) proteinCups = 8;
  if (carbCups    > 8) carbCups    = 8;
  if (fatCups     > 3) fatCups     = 3;

  // key rule: protein should not be LOWER than carbs
  if (proteinCups < carbCups) {
    proteinCups = carbCups;
  }

  // Veg & fruit scale gently with total calories
  let vegCups, fruitCups;
  if (targetCalories < 1600) {
    vegCups = 4;
    fruitCups = 2;
  } else if (targetCalories < 2100) {
    vegCups = 5;
    fruitCups = 3;
  } else {
    vegCups = 6;
    fruitCups = 3;
  }

  // Seeds & dressings stay small flavour room
  let seedsCups;
  if (targetCalories < 1600) {
    seedsCups = 1;
  } else if (targetCalories < 2200) {
    seedsCups = 2;
  } else {
    seedsCups = 3;
  }

  return {
    Protein: proteinCups,
    Carbs: carbCups,
    Veggies: vegCups,
    Fruits: fruitCups,
    "Healthy Fats": fatCups,
    "Seeds & Dressings": seedsCups
  };
}
